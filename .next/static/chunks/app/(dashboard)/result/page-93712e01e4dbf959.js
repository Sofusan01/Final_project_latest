(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[34],{468:(e,t,l)=>{Promise.resolve().then(l.bind(l,1486))},1486:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>L});var s=l(5155),r=l(2115),a=l(4982),n=l(3540),o=l(2859),i=l(4754),c=l(6025),d=l(2071),u=l(3778),m=l(4775);let x=(0,a.UU)("https://filyujdgxtjoqkebvegb.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZpbHl1amRneHRqb3FrZWJ2ZWdiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA3NTk1NjAsImV4cCI6MjA2NjMzNTU2MH0.2-CROlvK_eQYoIvI9PqRRmLGOfLD2TQnsQfwMAyxJ0k"),h={temp:{label:"Temperature",unit:"\xb0C",colors:["#ef4444","#dc2626","#b91c1c"]},humid:{label:"Humidity",unit:"%",colors:["#3b82f6","#2563eb","#1d4ed8"]},wt:{label:"Water Temperature",unit:"\xb0C",colors:["#06b6d4","#0891b2","#0e7490"]},ph:{label:"pH",unit:"",colors:["#8b5cf6","#7c3aed","#6d28d9"]},ec:{label:"EC",unit:"EC",colors:["#10b981","#059669","#047857"]},lux:{label:"Light",unit:"lux",colors:["#f59e0b","#d97706","#b45309"]}},f=new Map;function p(e){let{active:t,payload:l,label:r}=e;return t&&l&&0!==l.length?(0,s.jsxs)("div",{className:"card p-3 shadow-lg",children:[(0,s.jsx)("p",{className:"font-medium text-neutral-900 mb-2",children:null!=r?r:""}),l.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,s.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:e.color}}),(0,s.jsxs)("span",{className:"text-neutral-600",children:[e.name,": ",(0,s.jsx)("span",{className:"font-medium text-neutral-900",children:"number"==typeof e.value?e.value.toFixed(2):"N/A"})]})]},t))]}):null}function b(e){let{sensorKey:t="ph",rangeHours:l=24,height:a=400,showHeader:b=!0,compact:g=!1}=e,[j,y]=(0,r.useState)([]),[v,N]=(0,r.useState)(!0),[k,w]=(0,r.useState)(null),C=(0,r.useMemo)(()=>"".concat(t,"-").concat(l),[t,l]),D=(0,r.useCallback)(async()=>{try{w(null);let e=f.get(C),t=Date.now();if(e&&t-e.timestamp<3e4){y(e.data),N(!1);return}N(!0);let s=new Date(Date.now()-60*l*6e4).toISOString(),r=new Date().toISOString(),{data:a,error:n}=await x.from("sensor_logs").select("id,floor,temp,humid,wt,ph,ec,lux,created_at").gte("created_at",s).lt("created_at",r).in("floor",[1,2,3]).order("created_at",{ascending:!0});if(n)throw Error(n.message);let o=a||[];f.set(C,{data:o,timestamp:t}),y(o),N(!1)}catch(e){console.error("Error fetching data:",e),w(e instanceof Error?e.message:"Unknown error"),N(!1)}},[C,l]);function T(e){return e<=24?"hour":e<=720?"day":e<=2160?"week":"day"}function S(e,t){let l=e.getUTCFullYear(),s=e.getUTCMonth(),r=e.getUTCDate();if("hour"===t)return new Date(Date.UTC(l,s,r,e.getUTCHours(),0,0,0));if("day"===t)return new Date(Date.UTC(l,s,r,0,0,0,0));if("week"===t){let e=new Date(Date.UTC(l,s,r,0,0,0,0)),t=(e.getUTCDay()+6)%7;return e.setUTCDate(e.getUTCDate()-t),e}return new Date(Date.UTC(l,s,1,0,0,0,0))}(0,r.useEffect)(()=>{let e=!0;return(async()=>{e&&await D()})(),()=>{e=!1}},[D]);let I=(0,r.useMemo)(()=>{if(0===j.length)return[];let e=T(l),s={};for(let l of j){let r=S(new Date(l.created_at),e).toISOString();s[r]||(s[r]={f1:[],f2:[],f3:[]});let a=l[t];"number"==typeof a&&(1===l.floor&&s[r].f1.push(a),2===l.floor&&s[r].f2.push(a),3===l.floor&&s[r].f3.push(a))}let r=Object.entries(s).map(e=>{let[t,l]=e,s=e=>e.length?e.reduce((e,t)=>e+t,0)/e.length:null;return{time:t,floor1:s(l.f1),floor2:s(l.f2),floor3:s(l.f3)}});if(r.length<=1){let t=new Date(new Date().getTime()-3600*l*1e3),s=new Date,a="hour"===e?36e5:"day"===e?864e5:"week"===e?6048e5:2592e6,n=[];for(let l=S(t,e).getTime();l<=s.getTime();l+=a)n.push({time:new Date(l).toISOString(),floor1:null,floor2:null,floor3:null});let o=new Map(r.map(e=>[e.time,e]));return n.map(e=>{var t;return null!=(t=o.get(e.time))?t:e})}return r.sort((e,t)=>e.time.localeCompare(t.time))},[j,t,l]),A=(0,r.useMemo)(()=>{let e={1:[],2:[],3:[]};for(let t of I)"number"==typeof t.floor1&&e[1].push(t.floor1),"number"==typeof t.floor2&&e[2].push(t.floor2),"number"==typeof t.floor3&&e[3].push(t.floor3);function t(e){if(!e.length)return{min:null,avg:null,max:null};let t=Math.min(...e),l=Math.max(...e);return{min:t,avg:e.reduce((e,t)=>e+t,0)/e.length,max:l}}return{f1:t(e[1]),f2:t(e[2]),f3:t(e[3])}},[I]);if(v)return(0,s.jsx)("div",{className:"flex items-center justify-center ".concat(g?"bg-transparent":"card"),style:{height:a},children:(0,s.jsxs)("div",{className:"flex flex-col items-center gap-3",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-neutral-400"}),(0,s.jsx)("p",{className:"text-neutral-500 text-sm",children:"Loading data..."})]})});if(k)return(0,s.jsx)("div",{className:"flex items-center justify-center text-red-600 ".concat(g?"bg-transparent":"card"),style:{height:a},children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-4xl mb-2",children:"⚠️"}),(0,s.jsx)("div",{className:"text-neutral-900 mb-2",children:"Error occurred"}),(0,s.jsx)("div",{className:"text-sm text-neutral-600",children:k}),(0,s.jsx)("button",{onClick:D,className:"mt-3 px-4 py-2 btn-primary",children:"Try Again"})]})});if(0===I.length)return(0,s.jsx)("div",{className:"flex items-center justify-center text-neutral-500 ".concat(g?"bg-transparent":"card"),style:{height:a},children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-4xl mb-2",children:"\uD83D\uDCCA"}),(0,s.jsx)("div",{className:"text-neutral-900 mb-2",children:"No data available"}),(0,s.jsxs)("div",{className:"text-sm text-neutral-600",children:["Last ",l," hours"]}),(0,s.jsx)("button",{onClick:D,className:"mt-3 px-4 py-2 btn-primary",children:"Refresh"})]})});let L=h[t];return(0,s.jsxs)("div",{className:"w-full ".concat(g?"bg-transparent":"card p-6"),children:[b&&(0,s.jsxs)("div",{className:"mb-6 flex justify-between items-start",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"".concat(g?"text-lg":"text-2xl"," font-bold text-heading mb-1"),children:L.label}),(0,s.jsxs)("p",{className:"text-sm text-muted",children:["Unit: ",L.unit||"No unit"," • Last ",l," hours"]})]}),(0,s.jsx)("button",{onClick:D,className:"px-3 py-1 text-xs btn-secondary",disabled:v,children:v?"Loading...":"Refresh"})]}),(0,s.jsx)("div",{className:"mb-4 grid grid-cols-1 sm:grid-cols-3 gap-2",children:[{key:"f1",label:"Floor 1",color:L.colors[0]},{key:"f2",label:"Floor 2",color:L.colors[1]},{key:"f3",label:"Floor 3",color:L.colors[2]}].map(e=>{let{key:t,label:l,color:r}=e,a=A[t];return(0,s.jsxs)("div",{className:"flex items-center justify-between rounded-xl border border-neutral-200 bg-white px-3 py-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"inline-block w-2.5 h-2.5 rounded-full",style:{backgroundColor:r}}),(0,s.jsx)("span",{className:"text-sm text-neutral-700",children:l})]}),(0,s.jsxs)("div",{className:"text-xs text-neutral-600",children:[(0,s.jsxs)("span",{className:"mr-3",children:["Min: ",(0,s.jsx)("b",{children:null===a.min?"-":a.min.toFixed(2)})]}),(0,s.jsxs)("span",{className:"mr-3",children:["Avg: ",(0,s.jsx)("b",{children:null===a.avg?"-":a.avg.toFixed(2)})]}),(0,s.jsxs)("span",{children:["Max: ",(0,s.jsx)("b",{children:null===a.max?"-":a.max.toFixed(2)})]})]})]},t)})}),(0,s.jsx)(n.u,{width:"100%",height:a,children:(0,s.jsxs)(o.Q,{data:I,margin:{top:g?10:20,right:g?15:30,left:g?10:20,bottom:g?10:20},children:[(0,s.jsxs)("defs",{children:[(0,s.jsxs)("linearGradient",{id:"floor1Gradient-".concat(t),x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,s.jsx)("stop",{offset:"5%",stopColor:L.colors[0],stopOpacity:.8}),(0,s.jsx)("stop",{offset:"95%",stopColor:L.colors[0],stopOpacity:.1})]}),(0,s.jsxs)("linearGradient",{id:"floor2Gradient-".concat(t),x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,s.jsx)("stop",{offset:"5%",stopColor:L.colors[1],stopOpacity:.8}),(0,s.jsx)("stop",{offset:"95%",stopColor:L.colors[1],stopOpacity:.1})]}),(0,s.jsxs)("linearGradient",{id:"floor3Gradient-".concat(t),x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,s.jsx)("stop",{offset:"5%",stopColor:L.colors[2],stopOpacity:.8}),(0,s.jsx)("stop",{offset:"95%",stopColor:L.colors[2],stopOpacity:.1})]})]}),(0,s.jsx)(i.d,{strokeDasharray:"3 3",stroke:"#e5e5e5",opacity:.7,horizontal:!0,vertical:!0}),(()=>{let e=T(l),t="week"===e||"day"===e&&l>2160;return(0,s.jsx)(c.W,{dataKey:"time",tickFormatter:t=>{let l=new Date(t);return"hour"===e?l.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit",hour12:!1}):"month"===e?l.toLocaleDateString(void 0,{month:"short",year:"2-digit"}):l.toLocaleDateString(void 0,{day:"2-digit",month:"short"})},fontSize:t?9:g?10:12,tick:{fill:"#6b7280",fontWeight:500},axisLine:{stroke:"#d1d5db"},tickLine:{stroke:"#d1d5db"},minTickGap:g?10:20,...t?{interval:0,minTickGap:0,angle:-45,tickMargin:6}:{}})})(),(0,s.jsx)(d.h,{fontSize:g?10:12,tick:{fill:"#6b7280",fontWeight:500},axisLine:{stroke:"#d1d5db"},tickLine:{stroke:"#d1d5db"},domain:"ph"===t?[0,8]:["auto","auto"],width:g?30:40}),(0,s.jsx)(u.m,{content:(0,s.jsx)(p,{}),cursor:{fill:"#f3f4f6",opacity:.5},labelFormatter:e=>{T(l);let t=new Date(e),s=t.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit",hour12:!1}),r=t.toLocaleDateString(void 0,{day:"2-digit",month:"short",year:"numeric"});return"".concat(r," • ").concat(s)}}),(0,s.jsx)(m.Gk,{type:"monotone",dataKey:"floor1",stroke:L.colors[0],strokeWidth:2,fill:"url(#floor1Gradient-".concat(t,")"),name:"Floor 1",connectNulls:!1,dot:!g&&{fill:L.colors[0],strokeWidth:2,r:4},activeDot:{r:6,fill:L.colors[0]}}),(0,s.jsx)(m.Gk,{type:"monotone",dataKey:"floor2",stroke:L.colors[1],strokeWidth:2,fill:"url(#floor2Gradient-".concat(t,")"),name:"Floor 2",connectNulls:!1,dot:!g&&{fill:L.colors[1],strokeWidth:2,r:4},activeDot:{r:6,fill:L.colors[1]}}),(0,s.jsx)(m.Gk,{type:"monotone",dataKey:"floor3",stroke:L.colors[2],strokeWidth:2,fill:"url(#floor3Gradient-".concat(t,")"),name:"Floor 3",connectNulls:!1,dot:!g&&{fill:L.colors[2],strokeWidth:2,r:4},activeDot:{r:6,fill:L.colors[2]}})]})})]})}var g=l(2111),j=l(1539),y=l(4992),v=l(8691),N=l(790),k=l(2098),w=l(2713),C=l(4653),D=l(5968),T=l(1284);let S=[{key:"ph",label:"pH",icon:g.A},{key:"ec",label:"EC",icon:j.A},{key:"temp",label:"Temperature",icon:y.A},{key:"humid",label:"Humidity",icon:v.A},{key:"wt",label:"Water Temperature",icon:N.A},{key:"lux",label:"Light",icon:k.A}],I=[{key:"single",label:"Single",icon:w.A},{key:"grid",label:"Grid",icon:C.A},{key:"list",label:"List",icon:D.A}],A=[{label:"24H",value:24},{label:"3Days",value:72},{label:"7Days",value:168},{label:"1M",value:720},{label:"6M",value:4320},{label:"1Y",value:8760}];function L(){let[e,t]=(0,r.useState)("single"),[l,a]=(0,r.useState)("ph"),[n,o]=(0,r.useState)(24),[i,c]=(0,r.useState)(!0);(0,r.useEffect)(()=>{let e=setTimeout(()=>c(!1),120);return()=>clearTimeout(e)},[]);let d=(0,r.useMemo)(()=>S.find(e=>e.key===l),[l]),u=(null==d?void 0:d.icon)||w.A;return i?(0,s.jsx)("div",{className:"min-h-screen bg-neutral-50 p-4 md:p-6 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-neutral-400"}),(0,s.jsx)("span",{className:"text-neutral-500 text-lg",children:"Loading results..."})]})}):(0,s.jsx)("div",{className:"min-h-screen bg-neutral-50 p-4 md:p-6",children:(0,s.jsxs)("div",{className:"w-full max-w-7xl mx-auto space-y-6",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-heading text-2xl md:text-3xl font-semibold tracking-tight",children:"Results & Analysis"}),(0,s.jsx)("p",{className:"text-muted text-sm md:text-base mt-1",children:"View sensor data trends over time and compare values between multiple variables"})]}),(0,s.jsxs)("div",{className:"hidden md:flex items-center gap-2 text-neutral-500",children:[(0,s.jsx)(T.A,{className:"w-4 h-4"}),(0,s.jsx)("span",{className:"text-sm",children:"Values shown are data for the selected time period"})]})]}),(0,s.jsxs)("div",{className:"flex flex-col md:flex-row items-stretch md:items-center justify-between gap-3",children:[(0,s.jsx)("div",{className:"flex items-center gap-1 bg-neutral-100 border border-neutral-200 rounded-xl p-1",children:I.map(l=>{let r=l.icon,a=e===l.key;return(0,s.jsxs)("button",{onClick:()=>t(l.key),className:["inline-flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-colors",a?"bg-neutral-900 text-white shadow-sm":"text-neutral-600 hover:text-neutral-900 hover:bg-neutral-200"].join(" "),type:"button",title:l.label,children:[(0,s.jsx)(r,{className:"w-4 h-4"}),(0,s.jsx)("span",{className:"hidden sm:inline",children:l.label})]},l.key)})}),(0,s.jsx)("div",{className:"flex flex-wrap gap-1 bg-neutral-100 border border-neutral-200 rounded-xl p-1",children:A.map(e=>{let t=n===e.value;return(0,s.jsx)("button",{onClick:()=>o(e.value),className:["px-3 py-2 rounded-lg text-xs md:text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-neutral-500/60",t?"bg-neutral-900 text-white":"text-neutral-600 hover:text-neutral-900 hover:bg-neutral-200"].join(" "),type:"button","aria-pressed":t,children:e.label},e.value)})})]}),"single"===e&&(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:S.map(e=>{let t=e.icon,r=l===e.key;return(0,s.jsxs)("button",{onClick:()=>a(e.key),className:["flex items-center gap-2 px-3 md:px-4 py-2 rounded-lg text-sm font-medium transition-all border focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-neutral-500/60",r?"bg-neutral-900 text-white border-transparent shadow":"bg-neutral-100 text-neutral-700 hover:bg-neutral-200 border-neutral-200"].join(" "),type:"button","aria-pressed":r,children:[(0,s.jsx)(t,{className:"w-4 h-4"}),(0,s.jsx)("span",{className:"hidden sm:inline",children:e.label})]},e.key)})})]}),"single"===e&&(0,s.jsx)(M,{sensor:l,currentSensor:d,CurrentIcon:u,rangeHours:n}),"grid"===e&&(0,s.jsx)(G,{rangeHours:n}),"list"===e&&(0,s.jsx)(H,{rangeHours:n})]})})}function M(e){let{sensor:t,currentSensor:l,CurrentIcon:r,rangeHours:a}=e;return(0,s.jsxs)("div",{className:"card overflow-hidden",children:[(0,s.jsx)("div",{className:"px-4 md:px-6 py-4 border-b border-neutral-200",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"p-2 bg-neutral-100 rounded-lg",children:(0,s.jsx)(r,{className:"w-5 h-5 text-neutral-600"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-heading",children:null==l?void 0:l.label}),(0,s.jsx)("p",{className:"text-muted text-sm",children:"Compare data across 3 floors"})]})]})}),(0,s.jsx)("div",{className:"p-4 md:p-6",children:(0,s.jsx)(b,{sensorKey:t,rangeHours:a})})]})}function O(e){let{sensor:t,rangeHours:l,compact:r=!1}=e,a=t.icon;return(0,s.jsxs)("div",{className:"card overflow-hidden",children:[(0,s.jsx)("div",{className:"px-4 py-3 border-b border-neutral-200 bg-neutral-50",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(a,{className:"w-4 h-4 text-neutral-600"}),(0,s.jsx)("h3",{className:"font-medium text-heading text-sm truncate",children:t.label})]})}),(0,s.jsx)("div",{className:r?"p-3":"p-4",children:(0,s.jsx)(b,{sensorKey:t.key,height:r?220:280,showHeader:!1,compact:!0,rangeHours:l})})]})}function G(e){let{rangeHours:t}=e;return(0,s.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:S.map(e=>(0,s.jsx)(O,{sensor:e,rangeHours:t,compact:!0},e.key))})}function H(e){let{rangeHours:t}=e;return(0,s.jsx)("div",{className:"space-y-4",children:S.map(e=>(0,s.jsx)(O,{sensor:e,rangeHours:t},e.key))})}}},e=>{var t=t=>e(e.s=t);e.O(0,[982,347,441,684,358],()=>t(468)),_N_E=e.O()}]);